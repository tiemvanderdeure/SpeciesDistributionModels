import{_ as a,c as i,ai as n,o as e}from"./chunks/framework.CxFKEkk3.js";const t="/SpeciesDistributionModels.jl/previews/PR23/assets/kwulflz.BadvMeF_.png",p="/SpeciesDistributionModels.jl/previews/PR23/assets/htlhlee.mOz6EZEj.png",l="/SpeciesDistributionModels.jl/previews/PR23/assets/kjyduah.DOMypd-N.png",h="/SpeciesDistributionModels.jl/previews/PR23/assets/raeuaak.BNwWCJ-Q.png",y=JSON.parse('{"title":"Example of a full species distribution modelling workflow","description":"","frontmatter":{},"headers":[],"relativePath":"eucalyptus_regnans.md","filePath":"eucalyptus_regnans.md","lastUpdated":null}'),k={name:"eucalyptus_regnans.md"};function r(d,s,o,c,E,g){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="Example-of-a-full-species-distribution-modelling-workflow" tabindex="-1">Example of a full species distribution modelling workflow <a class="header-anchor" href="#Example-of-a-full-species-distribution-modelling-workflow" aria-label="Permalink to &quot;Example of a full species distribution modelling workflow {#Example-of-a-full-species-distribution-modelling-workflow}&quot;">​</a></h1><p>This example fits and projects species distribution models for the tree species <em>Eucaplytus regnans</em> from scratch.</p><h2 id="Environmental-data" tabindex="-1">Environmental data <a class="header-anchor" href="#Environmental-data" aria-label="Permalink to &quot;Environmental data {#Environmental-data}&quot;">​</a></h2><p>We start by downloading environmental data. We use the <a href="./www.github.com/rafaqz/Rasters.jl">Rasters</a> package to handle raster data, and RasterDataSources.jl to automatically download Worldclim data.</p><p>In this example, we just download bioclimatic variables 1 and 12 (annual mean temperature and annual mean precipitation). We then mask to the country borders of Australia.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Rasters, RasterDataSources, ArchGDAL, NaturalEarth, DataFrames</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RasterStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WorldClim{BioClim}, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">countries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> naturalearth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ne_10m_admin_0_countries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataFrame</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">australia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> subset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(countries, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ByRow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Australia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">geometry</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bio_aus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Rasters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bio; with </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> australia)[X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 110</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ..</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 156</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">45</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ..</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ 244×198 RasterStack ┐</span></span>
<span class="line"><span>├─────────────────────┴────────────────────────────────────────────────── dims ┐</span></span>
<span class="line"><span>  ↓ X Projected{Float64} 112.99999999999999:0.16666666666666666:153.49999999999997 ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span>  → Y Projected{Float64} -10.833333333333334:-0.16666666666666666:-43.666666666666664 ReverseOrdered Regular Intervals{Start}</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────── layers ┤</span></span>
<span class="line"><span>  :bio1  eltype: Union{Missing, Float32} dims: X, Y size: 244×198</span></span>
<span class="line"><span>  :bio12 eltype: Union{Missing, Float32} dims: X, Y size: 244×198</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span>  extent: Extent(X = (112.99999999999999, 153.66666666666663), Y = (-43.666666666666664, -10.666666666666668))</span></span>
<span class="line"><span>  missingval: missing</span></span>
<span class="line"><span>  crs: GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><p>Let&#39;s plot this data to see what it looks like.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CairoMakie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Rasters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rplot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bio_aus)</span></span></code></pre></div><p><img src="`+t+`" alt=""></p><h2 id="Occurrence-data" tabindex="-1">Occurrence data <a class="header-anchor" href="#Occurrence-data" aria-label="Permalink to &quot;Occurrence data {#Occurrence-data}&quot;">​</a></h2><p>Next, we use <a href="./www.github.com/rafaqz/GBIF2.jl">GBIF2.jl</a> to download occurrence records for this species. We use the <a href="/SpeciesDistributionModels.jl/previews/PR23/api#SpeciesDistributionModels.thin-Tuple{Any, Any}">thin</a> function in this package to weed out occurrences that are very close to each other, using a cut-off of 5km.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GBIF2, SpeciesDistributionModels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> species_match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Eucalyptus regnans&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">occurrences_raw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> occurrence_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sp; year </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1970</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), country </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;AU&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hasCoordinate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, limit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">occurrences </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> thin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(occurrences_raw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">geometry, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1280-element Vector{Tuple{Float64, Float64}}:</span></span>
<span class="line"><span> (145.98298, -38.33349)</span></span>
<span class="line"><span> (147.497946, -41.301006)</span></span>
<span class="line"><span> (147.255219, -41.237844)</span></span>
<span class="line"><span> (146.35, -37.36667)</span></span>
<span class="line"><span> (145.19167, -37.41639)</span></span>
<span class="line"><span> (147.899871, -41.147461)</span></span>
<span class="line"><span> (146.782197, -41.376415)</span></span>
<span class="line"><span> (146.779808, -41.37551)</span></span>
<span class="line"><span> (146.3125, -38.56111)</span></span>
<span class="line"><span> (146.24194, -38.52083)</span></span>
<span class="line"><span> ⋮</span></span>
<span class="line"><span> (147.683384, -41.2547)</span></span>
<span class="line"><span> (143.50361, -38.71111)</span></span>
<span class="line"><span> (143.59472, -38.70083)</span></span>
<span class="line"><span> (147.985049, -41.145683)</span></span>
<span class="line"><span> (147.823221, -41.164518)</span></span>
<span class="line"><span> (147.985505, -41.145895)</span></span>
<span class="line"><span> (146.16306, -37.83139)</span></span>
<span class="line"><span> (147.996952, -41.097568)</span></span>
<span class="line"><span> (146.15806, -37.84111)</span></span></code></pre></div><h2 id="Background-points" tabindex="-1">Background points <a class="header-anchor" href="#Background-points" aria-label="Permalink to &quot;Background points {#Background-points}&quot;">​</a></h2><p>Next, we sample random points to use as background points.</p><p>Let&#39;s plot both the occurrence and background points to see where <em>Eucalyptus regnans</em> is found.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StatsBase </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to active Rasters.sample</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bg_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Rasters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bio_aus, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; skipmissing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, geometry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (X,Y))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bg_points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getproperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(bg_data, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:geometry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig, ax, pl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bio_aus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bio1)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">scatter!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax, occurrences; color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :red</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">scatter!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax, bg_points; color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :grey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig</span></span></code></pre></div><p><img src="`+p+`" alt=""></p><h2 id="Handling-data" tabindex="-1">Handling data <a class="header-anchor" href="#Handling-data" aria-label="Permalink to &quot;Handling data {#Handling-data}&quot;">​</a></h2><p>SpeciesDistributionModels.jl has a <a href="/SpeciesDistributionModels.jl/previews/PR23/api#SpeciesDistributionModels.sdmdata-Tuple{Any, Any}">sdmdata</a> function to handle input data. It takes tabular presence and background data as inputs, such as what is returned by <code>Rasters.extract</code> and <code>Rasters.sample</code>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SpeciesDistributionModels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bio_aus, occurrences; skipmissing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sdmdata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p_data, bg_data; resampler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nfolds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SDMdata object with 1262 presence points and 500 absence points. </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Resampling: </span></span>
<span class="line"><span>Data is divided into 3 folds using resampling strategy CV(nfolds = 3, …).</span></span>
<span class="line"><span>┌──────┬─────────┬────────┐</span></span>
<span class="line"><span>│ fold │ # train │ # test │</span></span>
<span class="line"><span>├──────┼─────────┼────────┤</span></span>
<span class="line"><span>│    1 │    1174 │    588 │</span></span>
<span class="line"><span>│    2 │    1175 │    587 │</span></span>
<span class="line"><span>│    3 │    1175 │    587 │</span></span>
<span class="line"><span>└──────┴─────────┴────────┘</span></span>
<span class="line"><span>Predictor variables: </span></span>
<span class="line"><span>┌───────┬────────────┬─────────┐</span></span>
<span class="line"><span>│ names │ scitypes   │ types   │</span></span>
<span class="line"><span>├───────┼────────────┼─────────┤</span></span>
<span class="line"><span>│ bio1  │ Continuous │ Float32 │</span></span>
<span class="line"><span>│ bio12 │ Continuous │ Float32 │</span></span>
<span class="line"><span>└───────┴────────────┴─────────┘</span></span>
<span class="line"><span>Also contains geometry data</span></span></code></pre></div><h2 id="Fitting-an-ensemble" tabindex="-1">Fitting an ensemble <a class="header-anchor" href="#Fitting-an-ensemble" aria-label="Permalink to &quot;Fitting an ensemble {#Fitting-an-ensemble}&quot;">​</a></h2><p>Now that we have our <code>data</code> object with presence and background data, we can fit our ensemble. The <code>sdm</code> function fits a whole ensemble, taking two arguments: a data object and a <code>NamedTuple</code> with models the ensemble should have. This can be any MLJ-compatible model. In this case, we use Maxnet, boosted regression trees (from the EvoTrees.jl package), and a GLM.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Maxnet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MaxnetBinaryClassifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EvoTrees</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EvoTreeClassifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MLJGLMInterface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LinearBinaryClassifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  maxnet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MaxnetBinaryClassifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  brt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EvoTreeClassifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  glm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LinearBinaryClassifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ensemble </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sdm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, models)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>trained SDMensemble, containing 9 SDMmachines across 3 SDMgroups </span></span>
<span class="line"><span></span></span>
<span class="line"><span>Uses the following models:</span></span>
<span class="line"><span>maxnet =&gt; MaxnetBinaryClassifier. </span></span>
<span class="line"><span>brt =&gt; EvoTreeClassifier. </span></span>
<span class="line"><span>glm =&gt; LinearBinaryClassifier.</span></span></code></pre></div><h2 id="Evaluating-an-ensemble" tabindex="-1">Evaluating an ensemble <a class="header-anchor" href="#Evaluating-an-ensemble" aria-label="Permalink to &quot;Evaluating an ensemble {#Evaluating-an-ensemble}&quot;">​</a></h2><p>We can evaluate the entire ensemble using any metric from <a href="https://github.com/JuliaAI/StatisticalMeasures.jl" target="_blank" rel="noreferrer">StatisticalMeasures.jl</a>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SpeciesDistributionModels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SDM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ev </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SDM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ensemble; measures </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; auc, accuracy))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SDMensembleEvaluation with 2 performance measures</span></span>
<span class="line"><span>train</span></span>
<span class="line"><span>┌──────────┬──────────┬──────────┐</span></span>
<span class="line"><span>│    model │      auc │ accuracy │</span></span>
<span class="line"><span>│      Any │  Float64 │  Float64 │</span></span>
<span class="line"><span>├──────────┼──────────┼──────────┤</span></span>
<span class="line"><span>│   maxnet │ 0.994725 │ 0.992338 │</span></span>
<span class="line"><span>│      brt │ 0.999974 │ 0.998014 │</span></span>
<span class="line"><span>│      glm │ 0.986313 │ 0.990919 │</span></span>
<span class="line"><span>│ ensemble │ 0.999458 │ 0.996595 │</span></span>
<span class="line"><span>└──────────┴──────────┴──────────┘</span></span>
<span class="line"><span>test</span></span>
<span class="line"><span>┌──────────┬──────────┬──────────┐</span></span>
<span class="line"><span>│    model │      auc │ accuracy │</span></span>
<span class="line"><span>│      Any │  Float64 │  Float64 │</span></span>
<span class="line"><span>├──────────┼──────────┼──────────┤</span></span>
<span class="line"><span>│   maxnet │ 0.992611 │ 0.992054 │</span></span>
<span class="line"><span>│      brt │ 0.992612 │ 0.992053 │</span></span>
<span class="line"><span>│      glm │ 0.985621 │  0.99035 │</span></span>
<span class="line"><span>│ ensemble │  0.99297 │ 0.991485 │</span></span>
<span class="line"><span>└──────────┴──────────┴──────────┘</span></span></code></pre></div><h2 id="predicting" tabindex="-1">Predicting <a class="header-anchor" href="#predicting" aria-label="Permalink to &quot;Predicting&quot;">​</a></h2><p>Next, we the climatic suitability of the species throughout Australia using <code>SpeciesDistributionModels.predict</code>. We can specify a <code>reducer</code> argument to get a single value, instead of a prediction for each member in the ensemble.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SDM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">predict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ensemble, bio_aus; reducer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mean)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pred; colorrange </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><img src="`+l+`" alt=""></p><h2 id="Understanding-the-model" tabindex="-1">Understanding the model <a class="header-anchor" href="#Understanding-the-model" aria-label="Permalink to &quot;Understanding the model {#Understanding-the-model}&quot;">​</a></h2><p><a href="./@ref">SDM.explain</a> offers tools to estimate the contribution and response curves for each variable. Currently, the only implemented method is Shapley values from the <a href="./www.gitlab.com/ExpandingMan/Shapley.jl">Shapley.jl</a> package.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SDM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">explain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ensemble; method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ShapleyValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">variable_importance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(expl)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(bio1 = 0.26673886241283645,</span></span>
<span class="line"><span> bio12 = 0.10830037422770482,)</span></span></code></pre></div><p>We can also interactively plot the model explanation to get response curves.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">interactive_response_curves</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(expl)</span></span></code></pre></div><p><img src="`+h+'" alt=""></p>',42)]))}const F=a(k,[["render",r]]);export{y as __pageData,F as default};
